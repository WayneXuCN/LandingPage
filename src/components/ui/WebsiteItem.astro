---
/**
 * WebsiteItem.astro
 * 网站卡片组件 - 极简导航风格
 *
 * 用于展示网站链接的卡片组件，采用极简导航风格设计。
 * 支持图片优化、悬停效果和响应式布局。纯静态组件，无需 React 水合。
 *
 * @component
 */
import { resolveContentHref } from '@lib/utils';
import { getWebsiteImage } from '@lib/websiteImages';
import { Image } from 'astro:assets';

/**
 * 网站项数据接口
 */
interface WebsiteItemData {
  /** 网站唯一标识符 */
  id?: string;
  /** 网站标题 */
  title: string;
  /** 网站封面图片文件名 */
  image: string;
  /** 网站链接地址 */
  url: string;
  /** 网站描述文本 */
  description: string;
}

/**
 * 组件属性接口
 */
interface Props {
  /** 网站数据对象 */
  item: WebsiteItemData;
  /** 是否优先加载图片，用于首屏重要内容 */
  priority?: boolean;
}

// 解构组件属性，设置默认优先级为false
const { item, priority = false } = Astro.props;

// 解析链接：外部链接直接使用，内部链接通过工具函数处理
const href = item.url?.startsWith('http') ? item.url : resolveContentHref(item.url, 'zh_CN');
// 判断是否为外部链接
const isExternal = typeof href === 'string' && href.startsWith('http');
// 验证链接有效性
const isValidHref = typeof href === 'string' && href.trim() !== '' && href !== '#';

// 获取本地优化图片：i18n中保存的是文件名，通过映射拿到ImageMetadata才能被Astro优化
const localImage = getWebsiteImage(item.image);
---

{/* 网站卡片容器 */}
<a
  href={isValidHref ? href : undefined}
  target={isExternal ? '_blank' : undefined}
  rel={isExternal ? 'noopener noreferrer' : undefined}
  aria-label={`访问 ${item.title}: ${item.description}`}
  class='group flex flex-row sm:flex-col gap-4 sm:gap-3 p-3 -mx-3 sm:mx-0 rounded-2xl hover:bg-gray-50 dark:hover:bg-white/5 transition-colors duration-300 items-center sm:items-stretch'
>
  {/* 图片容器 */}
  <div
    class='relative w-24 sm:w-full shrink-0 aspect-[16/9] overflow-hidden rounded-lg sm:rounded-xl bg-gray-100 dark:bg-gray-800 shadow-sm group-hover:shadow-md transition-all duration-300'
  >
    {
      localImage ? (
        /* 优化后的本地图片 */
        <Image
          src={localImage}
          alt={item.title}
          width={640}
          height={360}
          widths={[384, 640]}
          layout='constrained'
          sizes='(max-width: 640px) 100vw, 384px'
          fit='cover'
          position='center'
          format='webp'
          quality={80}
          priority={priority}
          class='w-full h-full object-cover transition-transform duration-500 group-hover:scale-105'
        />
      ) : (
        /* 备用图片 */
        <img
          src={item.image}
          alt={item.title}
          width={640}
          height={360}
          loading={priority ? 'eager' : 'lazy'}
          decoding='async'
          fetchpriority={priority ? 'high' : 'auto'}
          sizes='(max-width: 640px) 100vw, 384px'
          class='w-full h-full object-cover transition-transform duration-500 group-hover:scale-105'
        />
      )
    }
    {/* 极轻微的内阴影，增加层次感 */}
    <div
      class='absolute inset-0 ring-1 ring-inset ring-black/5 dark:ring-white/10 rounded-lg sm:rounded-xl'
    >
    </div>
  </div>

  {/* 内容区域：标题和描述 */}
  <div class='flex flex-col min-w-0 flex-grow px-0 sm:px-1'>
    {/* 标题行：包含标题和箭头图标 */}
    <div class='flex items-center justify-between'>
      <h3
        class='text-base font-bold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors truncate pr-2'
      >
        {item.title}
      </h3>
      {/* 外部链接指示箭头：悬停时显示 */}
      <svg
        class='w-3.5 h-3.5 text-gray-500 group-hover:text-blue-500 transition-all opacity-0 group-hover:opacity-100 transform -translate-x-2 group-hover:translate-x-0 duration-300 hidden sm:block'
        fill='none'
        viewBox='0 0 24 24'
        stroke='currentColor'
      >
        <path
          stroke-linecap='round'
          stroke-linejoin='round'
          stroke-width='2'
          d='M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14'></path>
      </svg>
    </div>

    {/* 描述文本 */}
    <p class='mt-0.5 sm:mt-1 text-sm text-gray-500 dark:text-gray-400 line-clamp-2 leading-relaxed'>
      {item.description}
    </p>
  </div>
</a>
