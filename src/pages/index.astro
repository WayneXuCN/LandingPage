---
/**
 * /index.astro - 根路径首页
 *
 * 说明：
 * - 直接渲染默认语言（中文）的首页内容
 * - 设置 redirectToDefaultLocale: false 后，/ 不再重定向
 * - canonical URL 指向 /zh/ 以避免 SEO 重复内容问题
 */
import BaseLayout from '@layouts/BaseLayout.astro';
import Hero from '@components/ui/Hero.astro';
import WebsitesSection from '@components/ui/WebsitesSection.astro';
import FeaturedPostsSection from '@components/ui/FeaturedPostsSection.astro';
import Footer from '@components/ui/Footer.astro';
import HeaderBar from '@components/react/HeaderBar.jsx';
import UnderlineEffects from '@components/react/UnderlineEffects.jsx';
import { getI18n, type Locale } from '@lib/i18n';
import rssData from '@data/rss-posts.json';

// 使用默认语言
const lang: Locale = 'zh_CN';

// 从内容集合获取翻译数据
const translations = await getI18n(lang);
const { site, nav, header, hero, websites, featuredPosts, footer } = translations;

// 当前路径用于导航高亮
const currentPath = Astro.url.pathname;

// 获取对应语言的 RSS 帖子
type RssPost = {
  id?: string;
  title: string;
  image: string;
  url: string;
  description?: string;
  categories?: string[];
  pubDate?: string;
};
const rssPosts = ((rssData as Record<string, RssPost[]>)[lang] || []) as RssPost[];

// canonical URL 指向带语言前缀的页面
const canonicalUrl = new URL('/zh_CN/', Astro.site);
---

<BaseLayout
  title={site.title}
  description={site.description}
  author={site.author}
  keywords={site.keywords}
  lang={lang}
  canonicalUrl={canonicalUrl.href}
>
  {/* HeaderBar 需要交互功能，保持 React island */}
  <HeaderBar client:load header={header} nav={nav} currentPath={currentPath} lang={lang} />

  {/* Hero 区块 - 纯展示，使用 Astro 组件 */}
  <Hero subtitle={hero?.subtitle} title={hero?.title} description={hero?.description} />

  {/* Websites 区块 - 纯展示，使用 Astro 组件 */}
  <WebsitesSection title={websites?.title} items={websites?.items || []} />

  {/* Featured Posts 区块 - 纯展示，使用 Astro 组件 */}
  <FeaturedPostsSection config={featuredPosts} rssPosts={rssPosts} language={lang} />

  {/* Footer - 纯展示，使用 Astro 组件 */}
  <Footer footer={footer} />

  {/* 下划线悬停效果 - 延迟加载 */}
  <UnderlineEffects client:idle />
</BaseLayout>
